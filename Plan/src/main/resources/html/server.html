<!DOCTYPE html>
<html>
<head>
    <title>Plan | Server</title>
    <meta name="description" content="Player Analysis window">
    <meta name="author" content="Rsl1122">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="https://puu.sh/tK0KL/6aa2ba141b.ico" type="image/x-icon">
    <link rel="stylesheet" href="./main.css">
    <link href="https://fonts.googleapis.com/css?family=Quicksand:300,400" rel="stylesheet">
    <script src="https://use.fontawesome.com/df48eb908b.js"></script>
</head>
<body>
<header>
    <div>
        <p class="right fa-stack fa-lg" style="padding: 23px; margin:8px">
            <i style="padding: 0; color: #fff; font-size: 100px;" class="fa fa-square fa-stack-1x"></i>
            <i style="padding: 0; color: #348e0f; font-size: 95px;" class="fa fa-square fa-stack-1x"></i>
            <i style="padding: 0; color: #fff; font-size: 60px;" class="fa fa-circle fa-stack-1x"></i>
            <span><div style="overflow: hidden; position: relative; width: 100%; height: 100%; top: -8px; left: 0px;">
                <i style="position: absolute; top: 10px; left: -4px; width: 100%; height: 100%; padding: 0px; color: #348e0f; font-size: 40px;" class="fa fa-bar-chart fa-stack-1x"></i>
            </div></span>
        </p>
        <p class="right">Player Analytics v.${version}</p>
        <h1>${serverName} | Server Analysis</h1>
    </div>
</header>
<div class="content-server">
    <div class="nav-bar row">
        <a href="javascript:void(0)" class="nav-button">
            <i class="fa fa-info-circle"></i> Information
        </a>
        <a href="javascript:void(0)" class="nav-button">
            <i class="fa fa-bar-chart"></i> Online Activity
        </a>
        <a href="javascript:void(0)" class="nav-button">
            <i class="fa fa-calendar"></i> Sessions
        </a>
        <a href="javascript:void(0)" class="nav-button">
            <i class="fa fa-cogs"></i> Performance
        </a>
        <a href="javascript:void(0)" class="nav-button">
            <i class="fa fa-list-alt"></i> Playerlist
        </a>
        <a href="javascript:void(0)" class="nav-button">
            <i class="fa fa-terminal"></i> Command usage
        </a>
        <a href="javascript:void(0)" class="nav-button">
            <i class="fa fa-globe"></i> Demographics
        </a>
        <a href="javascript:void(0)" class="nav-button">
            <i class="fa fa-cubes"></i> Plugins
        </a>
    </div>
    <div id="limiter" class="main-limiter">
        <div id="main" class="main-wrapper">
            <div id="tab-information" class="tab">
                <div class="row">
                    <div class="column">
                        <div class="box-header">
                            <h2><i class="fa fa-bar-chart"></i> Players Online</h2>
                        </div>
                        <div class="box-footer">
                            <div id="playerChartDay" style="width: 100%; height: 400px;"></div>
                        </div>
                    </div>
                    <div class="column">
                        <div class="box-header">
                            <h2><i class="fa fa-info-circle"></i> Information</h2>
                        </div>
                        <div class="box" style="margin-bottom: 5px;">
                            <div class="row">
                                <div class="column">
                                    <p>${playersOnline}/${playersMax} Players Online<br>43 New Players Today<br>
                                        <br>
                                        ${playersActive} Active Players<br>
                                        ${playersTotal} Total Players<br>
                                        <br>
                                        Peak Time: ${lastPeakTime}<br>
                                        Last Peak: ${playersLastPeak} Players<br>
                                        <br>
                                        <b>All Time Peak:</b><br>
                                        ${bestPeakTime}: ${playersBestPeak} Players
                                    </p>
                                </div>
                                <div class="column">
                                    <p><b>Averages:</b><br>
                                    &#x2022; Session Length: ${sessionAverage}<br>
                                    &#x2022; Players / Day: ${playersAverage}<br>
                                    &#x2022; New Players / Day: ${playersNewAverage}<br>
                                    <br>
                                    <b>Total:</b><br>
                                    &#x2022; Playtime: ${playtimeTotal}<br>
                                    &#x2022; Sessions: ${sessionCount}<br>
                                    &#x2022; Kills: ${killCount}<br>
                                    &#x2022; Mob Kills: ${mobKillCount}<br>
                                    &#x2022; Deaths: ${deathCount}<br></p>
                                </div>
                            </div>
                        </div>
                        <div class="box-header">
                            <h2><i class="fa fa-calendar-check-o"></i> Recent Logins</h2>
                        </div>
                        <div class="box-footer" style="padding: 2px;">
                            <table>
                                <thead>
                                <tr>
                                    <th>Player</th>
                                    <th>Seen</th>
                                </tr>
                                </thead>
                                <tbody>
                                ${tableBodyRecentLogins}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div id="tab-online-activity" class="tab column">
                <div class="row">
                    <div class="column">
                        <div class="box-header">
                            <h2><i class="fa fa-bar-chart"></i> Players Online</h2>
                        </div>
                        <div class="box-footer">
                            <div id="playerChartMonth" style="width: 100%; height: 400px;"></div>
                        </div>
                    </div>
                    <div class="column">
                        <div class="box-header">
                            <h2><i class="fa fa-braille"></i> Player Join PunchCard</h2>
                        </div>
                        <div class="box-footer">
                            <div id="punchcard" style="width: 100%; height: 400px;"></div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="column">
                        <div class="box-header">
                            <h2>Last 24 Hours</h2>
                        </div>
                        <div class="box">
                            <p>Unique Players: ${playersDay}<br>
                                Unique / Day: ${playersAverageDay}</p>
                            <p>New Players: ${playersNewDay} <br>
                                New / Day: ${playersNewAverageDay}</p>
                        </div>
                    </div>
                    <div class="column">
                        <div class="box-header">
                            <h2>Last 7 Days</h2>
                        </div>
                        <div class="box">
                            <p>Unique Players: ${playersWeek}<br>
                                Unique / Day: ${playersAverageWeek}</p>
                            <p>New Players: ${playersNewWeek}<br>
                                New / Day: ${playersNewAverageWeek}</p>
                        </div>
                    </div>
                    <div class="column">
                        <div class="box-header">
                            <h2>Last 30 Days</h2>
                        </div>
                        <div class="box">
                            <p>Unique Players: ${playersMonth}<br>
                                Unique / Day: ${playersAverageMonth}</p>
                            <p>New Players: ${playersNewMonth}<br>
                                New / Day: ${playersNewAverageMonth}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div id="tab-sessions" class="tab">
                <div class="row" style="flex-grow: 2; width: 140%;">
                    <div class="column">
                        <div class="box-header">
                            <h2><i class="fa fa-calendar"></i> 50 Most Recent Sessions</h2>
                        </div>
                        <div class="box-footer scrollbar" style="padding: 2px;">
                            <table class="sortable table">
                                <thead>
                                <tr>
                                    <th>Player</th>
                                    <th>Started</th>
                                    <th>Length</th>
                                    <th>World - Time</th>
                                </tr>
                                </thead>
                                <tbody>
                                ${tableBodySessions}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="column">
                        <div class="box-header">
                            <h2><i class="fa fa-pie-chart"></i> World Playtime</h2>
                        </div>
                        <div class="box-footer">
                            <div id="worldPie" style="width: 100%; height: 350px;"></div>
                        </div>
                        <div class="box-header">
                            <h2><i class="fa fa-pie-chart"></i> Playerbase</h2>
                        </div>
                        <div class="box-footer">
                            <div id="activityPie" style="width: 100%; height: 350px;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="tab-performance" class="tab">
                <div class="column">
                    <div class="row"> 
                        <div class="column">
                            <div class="box-header">
                                <h2><i class="fa fa-bar-chart"></i> Ticks Per Second</h2>
                            </div>
                            <div class="box-footer">
                                <div id="tpsGraph" style="width: 100%; height: 350px;"></div>
                            </div>
                        </div>
                        <div class="column">
                            <div class="box-header">
                                <h2><i class="fa fa-bar-chart"></i> Resource Usage</h2>
                            </div>
                            <div class="box-footer">
                                <div id="resourceGraph" style="width: 100%; height: 350px;"></div>
                            </div>
                        </div>
                    </div> 
                    <div class="row">
                        <div class="column">
                            <div class="box-header">
                                <h2><i class="fa fa-bar-chart"></i> World Load</h2>
                            </div>
                            <div class="box-footer">
                                <div id="worldGraph" style="width: 100%; height: 350px;"></div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="column">
                                <div class="box-header">
                                    <h2><i class="fa fa-cogs"></i> Last 24 Hours</h2>
                                </div>
                                <div class="box">
                                    <p><b>Averages:</b></p>
                                    <ul>
                                        <li>TPS: ${tpsAverageDay}</li>
                                        <li>CPU: ${cpuAverageDay}</li>
                                        <li>RAM: ${ramAverageDay}</li>
                                        <li>Entities: ${entityAverageDay}</li>
                                        <li>Chunks: ${chunkAverageDay}</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="column">
                                <div class="box-header">
                                    <h2><i class="fa fa-cogs"></i> Last 7 Days</h2>
                                </div>
                                <div class="box">
                                    <p><b>Averages:</b></p>
                                    <ul>
                                        <li>TPS: ${tpsAverageWeek}</li>
                                        <li>CPU: ${cpuAverageWeek}</li>
                                        <li>RAM: ${ramAverageWeek}</li>
                                        <li>Entities: ${entityAverageWeek}</li>
                                        <li>Chunks: ${chunkAverageWeek}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="tab-playerlist" class="tab">
                <div class="column">
                    <div class="box-header">
                        <h2><i class="fa fa-list"></i> Playerlist</h2>
                    </div>
                    <div class="box-footer scrollbar" style="padding: 2px;">
                        <table class="sortable table">
                            <thead>
                            <tr>
                                <th><i class="fa fa-user"></i> Player</th>
                                <th><i class="fa fa-check"></i> Active</th>
                                <th><i class="fa fa-clock-o"></i> Playtime</th>
                                <th><i class="fa fa-calendar-plus-o"></i> Login times</th>
                                <th><i class="fa fa-user-plus"></i> Registered</th>
                                <th><i class="fa fa-calendar-check-o"></i> Last seen</th>
                                <th><i class="fa fa-globe"></i> Geolocation</th>
                            </tr>
                            </thead>
                            <tbody>
                            ${tableBodyPlayerList}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="tab-command-usage" class="tab">
                <div class="column">
                    <div class="box-header">
                        <h2><i class="fa fa-terminal"></i> Command Usage</h2>
                    </div>
                    <div class="box-footer scrollbar" style="padding: 2px;">
                        <table class="sortable table">
                            <thead>
                            <tr>
                                <th><i class="fa fa-chevron-right"></i> Command</th>
                                <th><i class="fa fa-list-ol"></i> Times used</th>
                            </tr>
                            </thead>
                            <tbody>
                            ${tableBodyCommands}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="tab-demographics" class="tab">
                <div class="column">
                    <div class="box-header">
                        <h2><i class="fa fa-globe"></i> Geolocations</h2>
                    </div>
                    <div class="box-footer" style="padding: 2px;">
                        <div id="choropleth" style="width: 100%; height: 600px;"></div>
                    </div>
                </div>
            </div>
            <div id="tab-plugins" class="tab column">
                ${tabContentPlugins}
            </div>
        </div>
    </div>
    <script src="https://www.kryogenix.org/code/browser/sorttable/sorttable.js"></script>
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/maps/modules/map.js"></script>
    <script src="https://code.highcharts.com/mapdata/custom/world.js"></script>
    <script src="https://code.highcharts.com/modules/drilldown.js"></script>
    <script src="https://code.highcharts.com/modules/no-data-to-display.js"></script>
    <script src="./js/activityPie.js"></script>
    <script src="./js/playerGraph.js"></script>
    <script src="./js/punchCard.js"></script>
    <script src="./js/resourceGraph.js"></script>
    <script src="./js/tpsGraph.js"></script>
    <script src="./js/worldGraph.js"></script>
    <script src="./js/worldMap.js"></script>
    <script src="./js/worldPie.js"></script>
    <script>
        Highcharts.setOptions({
            lang: {noData: "No Data to Display"},
            global: {
                timezoneOffset: ${timeZone} *  60
            }
        });
		// Data Variables
		var playersOnlineSeries = {
			name: 'Players Online',
			data: ${playersOnlineSeries},
			type: 'areaspline',
			color: '${playersGraphColor}',
            tooltip: {
            valueDecimals: 0
        }
        };
        var tpsSeries = {
            name: 'TPS',
            data: ${tpsSeries},
            type: 'spline',
            zones: [{
                value: ${tpsMedium},
                color: '${tpsLowColor}'
            }, {
                value: ${tpsHigh},
                color: '${tpsMediumColor}'
            }, {
                value: 30,
                color: '${tpsHighColor}'
            }],
            tooltip: {
                valueDecimals: 2
            },
            yAxis: 1
        };
        var cpuSeries = {
            name: 'CPU Usage',
            data: ${cpuSeries},
            type: 'areaspline',
            color: '#e0d264',
            tooltip: {
            pointFormat: '{series.name}: <b>{point.y:.2f}%</b>'
        }
        };
        var ramSeries = {
            name: 'RAM Usage',
            data: ${ramSeries},
            type: 'areaspline',
            color: '#7dcc24',
            tooltip: {
            valueDecimals: 0
        },
        yAxis: 1
        };
        var entitySeries = {
            name: 'Loaded Entities',
            data: ${entitySeries},
            type: 'areaspline',
            color: '#ac69ef',
            tooltip: {
            valueDecimals: 0
        },
        yAxis: 1
        };
        var chunkSeries = {
            name: 'Loaded Chunks',
            data: ${chunkSeries},
            type: 'areaspline',
            color: '#b58310',
            tooltip: {
            valueDecimals: 0
        }
        };
        var activitySeries = {
            name: 'Players',
            colorByPoint: true,
            data: [{
                name: 'Active',
                y: ${active}
            }, {
                name: 'Inactive',
                y: ${inactive},
                sliced: true,
                selected: true
            }, {
                name: 'Single Join',
                    y: ${joinLeaver}
            }, {
                name: 'Banned',
                    y: ${banned}
            }]
        };
        var worldSeries = {
            name: 'World Playtime',
            colorByPoint: true,
            data: ${worldSeries}
        };
        var gmSeries = ${gmSeries};
        var mapSeries = {
            name: 'Players',
            type: 'map',
            mapData: Highcharts.maps['custom/world'],
            data: ${geoMapSeries},
            joinBy: ['iso-a3', 'code']
        };
        var punchcardSeries = {
            name: 'Relative Activity',
            color: '#222',
            data: ${punchCardSeries}
        };

    </script>
    <script>
            var navButtons = document.getElementsByClassName("nav-button");
            var tabs = document.getElementsByClassName("tab");
            var slideIndex = window.sessionStorage.getItem("AnalysisSlideIndex");
            if (slideIndex === null) {
                slideIndex = 0;
            }
            var x = document.getElementById("main");
            x.style.transform = "translate3d(0px,0px,0)";
            x.style.width = "" + navButtons.length * 100 + "%";
            for (var i = 0; i < navButtons.length; i++) {
                navButtons[i].onclick = openFunc(i);
                tabs[i].style.width = "" + 100 / navButtons.length + "%";
            }
            x.style.opacity = "1";
            openFunc(slideIndex)();
            activityPie('activityPie', activitySeries, ${playersTotal}, [${activityColors}]);
            worldPie('worldPie', worldSeries, gmSeries);
            playersChart('playerChartDay', playersOnlineSeries, 1);
            playersChart('playerChartMonth', playersOnlineSeries, 4);
            tpsChart('tpsGraph', tpsSeries, playersOnlineSeries);
            resourceChart('resourceGraph', cpuSeries, ramSeries);
            worldChart('worldGraph', entitySeries, chunkSeries);
            worldMap('choropleth', '#EEFFEE', '#267f00', mapSeries);
            punchCard('punchcard', punchcardSeries);
            /*countUpTimer();*/

            function openFunc(i) {
                return function() {                    
                    var max = navButtons.length;
                    for (var j = 0; j < max; j++) {
                        if (j === i) {
                            navButtons[j].classList.add('active');
                            continue;
                        }
                        if (navButtons[j].classList.contains('active')) {
                            navButtons[j].classList.remove('active');
                        }
                    }
                    var percent = - 100 / navButtons.length;
                    slideIndex = i;
                    if (slideIndex > max) {
                        slideIndex = 0
                    }
                    if (slideIndex < 0) {
                        slideIndex = max
                    }
                    window.sessionStorage.setItem("AnalysisSlideIndex", slideIndex);
                    var value = slideIndex * percent;
                    x.style.transition = "0.5s";
                    x.style.transform = "translate3d(" + value + "%,0px,0)";
                };
            }

    </script>
</div>
</body>
</html>